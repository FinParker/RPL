pattern CVE-2018-21000

use {
    std::vec::Vec
	std::mem::size_of
	std::mem::forget
}

util {
    p_reversed_para(
        T1: ty
        T2: ty
        op: binop
    ) = 
        pub fn _ (..) -> _
        {
            @let $vec: Vec<$T1> = _;
            @let $size = size_of::<$T2>();
            @let $cap = $vec.capacity() $op $size;
            @let $len = $vec.len() $op $size;
            @let $ptr = $vec.as_mut_ptr();
            @let $ptr = $ptr as *mut u8;
            forget($vec);
            @let _ = Vec::from_raw_parts($ptr, $cap, $len)
        }
}

patt {
    p1 = p_reversed_para(
            T2 = u8
            op = *
        )

    p2 = p_reversed_para(
            T2 = u8
            op = /
        )
}