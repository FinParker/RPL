pattern CVE-2020-35898/9

use {
    std::cell::UnsafeCell
    std::rc::Rc
}

util {
    p_struct = 
        pub struct $Cell<$T> {
            $inner: Rc<UnsafeCell<$T>>,
        }
    

    p_clone = 
        impl<$T> Clone for $Cell<$T> {
            fn clone(&self) -> Self {
                $Cell::#new!{
                    $inner: self.$inner.clone(),
                }
            }
        }
    

    p_get_mut = 
        impl<$T> $Cell<$T> {
            fn $get_mut(&mut self) -> &mut $T {
                @let $res = *self.$inner;
                @let $res = $res.as_ref();
                @let $res = $res.get();
                $res
            }
        }
}

patt {
    p = 
        & p_struct 
        & p_clone 
        & p_get_mut
}




