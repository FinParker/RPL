// original: @frank-king
// modified: @stuuupidcat

pattern CVE-2020-25016

mvar {
  trait_name: ident
  as_bytes: ident
  as_bytes_mut: ident
}

rustc {
    fn judge<'tcx>(item: &'tcx Item<'tcx>) -> bool {
        /* 下面是一段rustc的代码 */
        /* 用于验证item的泛型参数及where约束中无任何 unsafe trait */
    }
}


util {
    p_trait = ```rust
        #without!{unsafe} pub trait $trait_name {
            fn $as_bytes(&self) -> &[u8];
            fn $as_bytes_mut(&mut self) -> &mut [u8];
        }
    ```
}

patt {
    foo = p_trait & judge($trait_name)
}
